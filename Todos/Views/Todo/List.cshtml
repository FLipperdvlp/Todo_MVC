@using Todos.Entities
@model IEnumerable<Todos.Models.TodoViewModel>    
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мои задачи</title>
    <link rel="stylesheet" href="~/css/styles.css">
</head>
<body>
    <div class="bg-elements"></div>

    <div class="todo-layout">
        <header class="todo-header">
            <div class="user-info">
                <div class="user-avatar">П</div>
                <div>
                    <h2>Пользователь</h2>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Добро пожаловать</p>
                </div>
            </div>
            <a href="auth.html" class="logout-btn">Выйти</a>
        </header>

        <div class="todo-container">
            <div class="add-todo">
                <form class="add-todo-form" asp-controller="Todo" asp-action="Create" method="post">
                    <input name="Text" type="text" class="add-todo-input" placeholder="Додати нову задачу..." required>
                    <input name="ExpiresAt" type="datetime-local" class="deadline-input" required>
                    <button type="submit" class="add-btn">Додати</button>
                </form>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number">@Model.Count()</div>
                    <div class="stat-label">Всего</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">@Model.Count(t => !t.IsCompleted)</div>
                    <div class="stat-label">Активных</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">@Model.Count(t => t.IsCompleted)</div>
                    <div class="stat-label">Завершено</div>
                </div>
            </div>

            <div class="todo-list">

                    @foreach (var todo in Model)
                    {
                        <div class="todo-item @(todo.IsCompleted ? "completed" : "")">
                            <form asp-controller="Todo" asp-action="Toggle" asp-route-id="@todo.Id" method="post">
                                <button type="submit" class="todo-checkbox @(todo.IsCompleted ? "checked" : "")"></button>
                            </form>
                            <div class="todo-meta">
                                <div class="todo-id">#@todo.Id</div>
                                <div class="todo-text">@todo.Text</div>
                                <div class="todo-dates">
                                    <span class="todo-created" style="display: block">
                                        Створено: @todo.CreatedAt
                                    </span>
                                    <span class="todo-deadline @(DateTime.Now > todo.ExpiresAt ? "overdue" : "")">
                                        Дедлайн: @todo.ExpiresAt
                                    </span>
                                </div>
                            </div>
                            <div class="category-badge category-personal">Персональне</div>
                            <div class="todo-actions">
                                <form asp-controller="Todo" asp-action="Delete" asp-route-id="@todo.Id" method="post" >
                                    <button type="submit" class="action-btn delete-btn">❌</button>
                                </form>
                            </div>
                        </div>
                    }
            </div>
        </div>
    </div>
</body>
</html>